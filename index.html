<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Poster Scan</title>
  <style>
    body{
      font-family:'Segoe UI',sans-serif;
      text-align:center;
      padding:40px;
      background:#f4f4f4;
      color:#333;
    }
    h1{font-size:1.8em;margin-bottom:20px}
    button{
      background:#2E8B57;color:#fff;border:none;
      padding:16px 32px;font-size:1.2em;
      border-radius:12px;cursor:pointer;
      box-shadow:0 4px 8px rgba(0,0,0,.2);
      transition:.3s;
    }
    button:hover{background:#276945;transform:scale(1.05)}
    button:disabled{opacity:.7;cursor:not-allowed}
    .thanks{margin-top:20px;font-size:1.1em;color:#2E8B57;display:none}
    .countdown{margin-top:10px;font-size:0.9em;color:#d35400;display:none}
  </style>
</head>
<body>
  <h1>Thank you for scanning!</h1>
  <p>Tap below to let me know you are at poster 1483 and would like to talk to me! (This will page me!)</p>
  <button onclick="sendScan()">Click to page me! (100% anonymous)</button>
  <p class="thanks" id="thanks">Sent 100% anonymously — Thank you! Be there ASAP.</p>
  <p class="countdown" id="countdown"></p>

  <script>
    // ---------- CONFIG ----------
    const COOLDOWN_KEY = 'poster1483_last_click';   // shared across browsers
    const COOLDOWN_MS  = 20 * 60 * 1000;              // 5 minutes
    const btn          = document.querySelector('button');
    const thanks       = document.getElementById('thanks');
    const countdownEl  = document.getElementById('countdown');
    let intervalId = null;

    // ---------- HELPERS ----------
    function formatTime(seconds){
      const m = Math.floor(seconds/60).toString().padStart(2,'0');
      const s = (seconds%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    function startCountdown(){
      clearInterval(intervalId);               // safety
      intervalId = setInterval(updateUI, 1000);
      updateUI();                              // immediate first render
    }

    function stopCountdown(){
      clearInterval(intervalId);
      intervalId = null;
    }

    // ---------- UI UPDATE ----------
    function updateUI(){
      const last = localStorage.getItem(COOLDOWN_KEY);
      const now  = Date.now();

      if (last && (now - parseInt(last)) < COOLDOWN_MS){
        const remainingSec = Math.ceil((COOLDOWN_MS - (now - parseInt(last))) / 1000);
        btn.style.display = 'none';
        thanks.style.display = 'block';
        countdownEl.textContent = `Button resets in ${formatTime(remainingSec)}`;
        countdownEl.style.display = 'block';
      } else {
        // cooldown over
        btn.style.display = 'inline-block';
        btn.disabled = false;
        btn.textContent = 'Click to page me! (100% anonymous)';
        thanks.style.display = 'none';
        countdownEl.style.display = 'none';
        localStorage.removeItem(COOLDOWN_KEY);
        stopCountdown();
      }
    }

    // ---------- PAGE LOAD ----------
    updateUI();                // show current state
    if (localStorage.getItem(COOLDOWN_KEY)) startCountdown();

    // ---------- CLICK ----------
    async function sendScan(){
      // prevent double-click while sending
      btn.disabled = true;
      btn.textContent = 'Sending…';

      try{
        await fetch('https://maker.ifttt.com/trigger/Paged to Poster/with/key/jULO7YKlFrrZw-hj7tG7v5x4AEz6TodDfU9_gMZsaKX',{
          method:'POST',
          body:new URLSearchParams({
            value1:new Date().toISOString(),
            value2:'poster_scan'
          })
        });
        // success → lock
        localStorage.setItem(COOLDOWN_KEY, Date.now().toString());
        startCountdown();
      }catch(e){
        console.warn('Send failed',e);
        // still lock to avoid spam
        localStorage.setItem(COOLDOWN_KEY, Date.now().toString());
        startCountdown();
      }
    }
  </script>
</body>
</html>
